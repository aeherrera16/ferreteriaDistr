<div class="card p-4 shadow-sm">
  <h2 class="mb-4">Editar Artículo</h2>

  <% if (serverMsg) { %>
  <div
    class="alert <%= serverMsg.includes('error') || serverMsg.includes('Error') || serverMsg.includes('duplicado') ? 'alert-danger' : 'alert-success' %>"
  >
    <%= serverMsg %>
  </div>
  <% } %>

  <form method="post" action="/articulos/<%= id %>/editar">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Código</label>
        <input
          class="form-control"
          name="codigo"
          value="<%= data.Codigo||'' %>"
        />
        <div class="form-text text-danger"><%= errors.Codigo||'' %></div>
      </div>

      <div class="col-md-8">
        <label class="form-label">Nombre</label>
        <input
          class="form-control"
          name="nombre"
          value="<%= data.Nombre||'' %>"
        />
        <div class="form-text text-danger"><%= errors.Nombre||'' %></div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Categoría</label>
        <select class="form-select" name="categoria" id="categoria-select">
          <option value="">Seleccione una categoría</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Precio compra</label>
        <input
          class="form-control"
          name="precio_compra"
          type="number"
          step="0.01"
          value="<%= data.PrecioCompra||'' %>"
          min="0"
        />
        <div class="form-text text-danger"><%= errors.PrecioCompra||'' %></div>
      </div>

      <div class="col-md-4">
        <label class="form-label">Precio venta</label>
        <input
          class="form-control"
          name="precio_venta"
          type="number"
          step="0.01"
          value="<%= data.PrecioVenta||'' %>"
          min="0"
        />
        <div class="form-text text-danger"><%= errors.PrecioVenta||'' %></div>
      </div>

      <div class="col-md-3">
        <label class="form-label">Stock</label>
        <input
          class="form-control"
          name="stock"
          type="number"
          value="<%= data.Stock||'' %>"
          min="0"
        />
        <div class="form-text text-danger"><%= errors.Stock||'' %></div>
      </div>

      <div class="col-md-3">
        <label class="form-label">Stock mínimo</label>
        <input
          class="form-control"
          name="stock_minimo"
          type="number"
          value="<%= data.StockMinimo||'' %>"
          min="0"
        />
        <div class="form-text text-danger"><%= errors.StockMinimo||'' %></div>
      </div>

      <div class="col-md-6">
        <label class="form-label">Proveedor</label>
        <select class="form-select" name="proveedor" id="proveedor-select">
          <option value="">Seleccione un proveedor</option>
        </select>
      </div>

      <div class="col-12 text-end mt-2">
        <button class="btn btn-primary">Actualizar</button>
      </div>
    </div>
  </form>

  <script>
    // Llenar select de categorías
    fetch("/articulos/api/categorias")
      .then((res) => res.json())
      .then((data) => {
        const select = document.getElementById("categoria-select");
        data.forEach((cat) => {
          const opt = document.createElement("option");
          opt.value = cat.id;
          opt.textContent = cat.nombre;
          if ("<%= data.Categoria||'' %>" == cat.id) opt.selected = true;
          select.appendChild(opt);
        });
      });
    // Llenar select de proveedores
    fetch("/articulos/api/proveedores")
      .then((res) => res.json())
      .then((data) => {
        const select = document.getElementById("proveedor-select");
        data.forEach((prov) => {
          const opt = document.createElement("option");
          opt.value = prov.id;
          opt.textContent = prov.nombre;
          if ("<%= data.Proveedor||'' %>" == prov.id) opt.selected = true;
          select.appendChild(opt);
        });
      });
  </script>
</div>
